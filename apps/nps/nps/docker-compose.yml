
services:
  nps:
    image: aiastia/nps:latest
    container_name: ${CONTAINER_NAME}
    hostname: nps-server
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./conf:/app/conf
      - ./cert:/cert
      - ./logs:/var/log/nps
      - ${WEB_KEY_FILE}:/conf/server.key
      - ${WEB_CERT_FILE}:/conf/server.pem
      - ./data:/data
    environment:
      # 核心参数
      - RUN_MODE=prod
      - HTTP_PROXY_PORT=${PANEL_APP_PORT_HTTP_PROXY_PORT}
      - HTTPS_PROXY_PORT=${PANEL_APP_PORT_HTTPS_PROXY_PORT}
      - BRIDGE_PORT=${PANEL_APP_PORT_BRIDGE_PORT}
      - WEB_PORT=${PANEL_APP_PORT_WEB_PORT}
      - PUBLIC_VKEY=${PUBLIC_VKEY}
      - WEB_USERNAME=${WEB_USERNAME}
      - WEB_PASSWORD=${WEB_PASSWORD}
      - WEB_HOST=${WEB_HOST}
      - ALLOW_PORTS=${ALLOW_PORTS:-9001-9009,10001,11000-12000}
      - AUTH_KEY=${AUTH_KEY}
      - AUTH_CRYPT_KEY=${AUTH_CRYPT_KEY}
      
      # SSL配置
      - WEB_OPEN_SSL=${WEB_OPEN_SSL:-false}
      - WEB_CERT_FILE=${WEB_CERT_FILE:-conf/server.pem}
      - WEB_KEY_FILE=${WEB_KEY_FILE:-conf/server.key}
      
      # 高级配置
      - WEB_IP=${WEB_IP:-0.0.0.0}
      - WEB_BASE_URL=${WEB_BASE_URL:-}
      - BRIDGE_TYPE=${BRIDGE_TYPE:-tcp}
      - BRIDGE_IP=${BRIDGE_IP:-0.0.0.0}
      - FLOW_STORE_INTERVAL=${FLOW_STORE_INTERVAL:-1}
      - MAX_POOL_COUNT=${MAX_POOL_COUNT:-15}
      - MAX_TUNNEL_NUM=${MAX_TUNNEL_NUM:-1000}
      - MAX_CONNECTIONS=${MAX_CONNECTIONS:-2000}
      - CONFIG_FILE_PATH=${CONFIG_FILE_PATH:-/conf/nps.conf}
      - P2P_IP=${P2P_IP:-}
      - P2P_PORT=${P2P_PORT:-6000}
      - DISCONNECT_TIMEOUT=${DISCONNECT_TIMEOUT:-60}
      - LOG_LEVEL=${LOG_LEVEL:-7}
      - ALLOW_USER_LOGIN=${ALLOW_USER_LOGIN:-true}
      - ALLOW_USER_REGISTER=${ALLOW_USER_REGISTER:-false}
      - ALLOW_USER_CHANGE_USERNAME=${ALLOW_USER_CHANGE_USERNAME:-false}
      - ALLOW_FLOW_LIMIT=${ALLOW_FLOW_LIMIT:-true}
      - ALLOW_RATE_LIMIT=${ALLOW_RATE_LIMIT:-true}
      - ALLOW_TUNNEL_NUM_LIMIT=${ALLOW_TUNNEL_NUM_LIMIT:-true}
      - ALLOW_LOCAL_PROXY=${ALLOW_LOCAL_PROXY:-true}
      - ALLOW_CONNECTION_NUM_LIMIT=${ALLOW_CONNECTION_NUM_LIMIT:-true}
      - ALLOW_MULTI_IP=${ALLOW_MULTI_IP:-false}
      - SYSTEM_INFO_DISPLAY=${SYSTEM_INFO_DISPLAY:-true}
      - HTTP_CACHE=${HTTP_CACHE:-true}
      - HTTP_CACHE_LENGTH=${HTTP_CACHE_LENGTH:-100}
      
      # 时区设置
      - TZ=${TZ:-Asia/Shanghai}
